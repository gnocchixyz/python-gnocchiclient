language: python
sudo: required

services:
  - docker

cache:
  directories:
    - ~/.cache/pip
env:
  - TARGET: pep8
  - TARGET: py27
  - TARGET: py35
  - TARGET: docs-gnocchi.xyz

before_script:
  - docker build --tag gnocchi-ci --file=tools/travis-ci-setup.dockerfile .
  # Allow docker to write in home directory
  - chmod -R o+w ~/
  - find ~/ -type d -exec chmod o+x {} \;
script:
  - docker run -v ~/.cache/pip:/home/tester/.cache/pip -v $(pwd):/home/tester/src gnocchi-ci tox -e ${TARGET}

notifications:
  email: false
  irc:
    on_success: change
    on_failure: always
    channels:
      - "irc.freenode.org#gnocchi"
